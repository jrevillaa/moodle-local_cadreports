{"version":3,"file":"dynamic_groups.min.js","sources":["../src/dynamic_groups.js"],"sourcesContent":["/**\n * AMD module para autocomplete dinámico de grupos usando AJAX manual\n * Plugin local_cadreports para Moodle 4.4\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification'], function($, Ajax, Notification) {\n\n    var DynamicGroups = {\n\n        /**\n         * Inicializar autocomplete dinámico\n         */\n        init: function() {\n            var courseSelect = $('#id_courseids');\n\n            // Escuchar cambios en la selección de cursos\n            courseSelect.on('change', function() {\n                DynamicGroups.updateGroupOptions(courseSelect.val());\n            });\n\n            // Actualizar al cargar si ya hay cursos seleccionados\n            if (courseSelect.val() && courseSelect.val().length > 0) {\n                DynamicGroups.updateGroupOptions(courseSelect.val());\n            }\n        },\n\n        /**\n         * Actualizar opciones del select de grupos\n         * @param {Array} selectedCourses Array de IDs de cursos seleccionados\n         */\n        updateGroupOptions: function(selectedCourses) {\n            var groupSelect = $('#id_groupids');\n\n            if (!selectedCourses || selectedCourses.length === 0) {\n                // Sin cursos seleccionados\n                DynamicGroups.clearGroupOptions(groupSelect);\n                DynamicGroups.updatePlaceholder(groupSelect, 'Selecciona primero uno o más cursos');\n            } else {\n                // Con cursos seleccionados - cargar grupos via AJAX\n                DynamicGroups.loadGroupsForCourses(selectedCourses, groupSelect);\n                DynamicGroups.updatePlaceholder(groupSelect, 'Cargando grupos...');\n            }\n        },\n\n        /**\n         * Limpiar opciones de grupos\n         * @param {jQuery} groupSelect Elemento select de grupos\n         */\n        clearGroupOptions: function(groupSelect) {\n            groupSelect.empty();\n            groupSelect.prop('disabled', true);\n        },\n\n        /**\n         * Actualizar placeholder del autocomplete\n         * @param {jQuery} groupSelect Elemento select de grupos\n         * @param {string} text Texto del placeholder\n         */\n        updatePlaceholder: function(groupSelect, text) {\n            var container = groupSelect.closest('.form-autocomplete-container');\n            if (container.length) {\n                var input = container.find('.form-autocomplete-original-text');\n                input.attr('placeholder', text);\n            }\n        },\n\n        /**\n         * Cargar grupos para cursos específicos\n         * @param {Array} courseIds Array de IDs de cursos\n         * @param {jQuery} groupSelect Elemento select de grupos\n         */\n        loadGroupsForCourses: function(courseIds, groupSelect) {\n            // Convertir a integers\n            var courseIdsInt = courseIds.map(function(id) {\n                return parseInt(id, 10);\n            });\n\n            // Llamada AJAX usando core/ajax de Moodle\n            Ajax.call([{\n                methodname: 'local_cadreports_get_groups_for_courses',\n                args: {\n                    courseids: courseIdsInt\n                },\n                done: function(groups) {\n                    DynamicGroups.populateGroupSelect(groupSelect, groups);\n                },\n                fail: function(error) {\n                    Notification.exception(error);\n                    DynamicGroups.clearGroupOptions(groupSelect);\n                    DynamicGroups.updatePlaceholder(groupSelect, 'Error cargando grupos');\n                }\n            }]);\n        },\n\n        /**\n         * Poblar el select de grupos con las opciones\n         * @param {jQuery} groupSelect Elemento select de grupos\n         * @param {Array} groups Array de grupos del servidor\n         */\n        populateGroupSelect: function(groupSelect, groups) {\n            // Limpiar opciones actuales\n            groupSelect.empty();\n\n            if (groups.length === 0) {\n                groupSelect.prop('disabled', true);\n                DynamicGroups.updatePlaceholder(groupSelect, 'No hay grupos en los cursos seleccionados');\n            } else {\n                // Agregar opciones de grupos\n                $.each(groups, function(index, group) {\n                    var option = new Option(\n                        group.name + ' (' + group.coursename + ')',\n                        group.id,\n                        false,\n                        false\n                    );\n                    groupSelect.append(option);\n                });\n\n                groupSelect.prop('disabled', false);\n                DynamicGroups.updatePlaceholder(groupSelect, 'Buscar y seleccionar grupos...');\n\n                // Refrescar el autocomplete para que detecte las nuevas opciones\n                groupSelect.trigger('change.select2');\n            }\n        }\n    };\n\n    return DynamicGroups;\n});\n"],"names":["define","$","Ajax","Notification","DynamicGroups","init","courseSelect","on","updateGroupOptions","val","length","selectedCourses","groupSelect","loadGroupsForCourses","updatePlaceholder","clearGroupOptions","empty","prop","text","container","closest","find","attr","courseIds","courseIdsInt","map","id","parseInt","call","methodname","args","courseids","done","groups","populateGroupSelect","fail","error","exception","each","index","group","option","Option","name","coursename","append","trigger"],"mappings":"AAKAA,yCAAO,CAAC,SAAU,YAAa,sBAAsB,SAASC,EAAGC,KAAMC,kBAE/DC,cAAgB,CAKhBC,KAAM,eACEC,aAAeL,EAAE,iBAGrBK,aAAaC,GAAG,UAAU,WACtBH,cAAcI,mBAAmBF,aAAaG,UAI9CH,aAAaG,OAASH,aAAaG,MAAMC,OAAS,GAClDN,cAAcI,mBAAmBF,aAAaG,QAQtDD,mBAAoB,SAASG,qBACrBC,YAAcX,EAAE,gBAEfU,iBAA8C,IAA3BA,gBAAgBD,QAMpCN,cAAcS,qBAAqBF,gBAAiBC,aACpDR,cAAcU,kBAAkBF,YAAa,wBAL7CR,cAAcW,kBAAkBH,aAChCR,cAAcU,kBAAkBF,YAAa,yCAYrDG,kBAAmB,SAASH,aACxBA,YAAYI,QACZJ,YAAYK,KAAK,YAAY,IAQjCH,kBAAmB,SAASF,YAAaM,UACjCC,UAAYP,YAAYQ,QAAQ,gCAChCD,UAAUT,QACES,UAAUE,KAAK,oCACrBC,KAAK,cAAeJ,OASlCL,qBAAsB,SAASU,UAAWX,iBAElCY,aAAeD,UAAUE,KAAI,SAASC,WAC/BC,SAASD,GAAI,OAIxBxB,KAAK0B,KAAK,CAAC,CACPC,WAAY,0CACZC,KAAM,CACFC,UAAWP,cAEfQ,KAAM,SAASC,QACX7B,cAAc8B,oBAAoBtB,YAAaqB,SAEnDE,KAAM,SAASC,OACXjC,aAAakC,UAAUD,OACvBhC,cAAcW,kBAAkBH,aAChCR,cAAcU,kBAAkBF,YAAa,8BAUzDsB,oBAAqB,SAAStB,YAAaqB,QAEvCrB,YAAYI,QAEU,IAAlBiB,OAAOvB,QACPE,YAAYK,KAAK,YAAY,GAC7Bb,cAAcU,kBAAkBF,YAAa,+CAG7CX,EAAEqC,KAAKL,QAAQ,SAASM,MAAOC,WACvBC,OAAS,IAAIC,OACbF,MAAMG,KAAO,KAAOH,MAAMI,WAAa,IACvCJ,MAAMd,IACN,GACA,GAEJd,YAAYiC,OAAOJ,WAGvB7B,YAAYK,KAAK,YAAY,GAC7Bb,cAAcU,kBAAkBF,YAAa,kCAG7CA,YAAYkC,QAAQ,4BAKzB1C"}